<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Datenbank Encrypter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config={darkMode:'class',theme:{extend:{colors:{mat:{bg:'#121212',surface:'#1e1e1e',primary:'#bb86fc'}}}}}</script>
    <style>body{background-color:#121212;color:#e0e0e0;font-family:sans-serif}</style>
</head>
<body class="p-8 max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold text-white mb-6">Admin Tool: Datenbank Generator</h1>
    
    <div class="bg-[#1e1e1e] p-4 rounded-lg border border-[#333] mb-6">
        <h2 class="font-bold text-purple-400 mb-4">1. Stundensätze & Anteile (Standard)</h2>
        <div class="grid grid-cols-2 gap-4 mb-4">
            <div><label class="block text-gray-400 text-xs uppercase">Koordinator (€)</label><input type="number" id="coord" value="85" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
        </div>
        <div class="grid grid-cols-3 gap-4">
            <div><label class="block text-gray-400 text-xs uppercase">Spezialist (€)</label><input type="number" id="r1" value="65" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
            <div><label class="block text-gray-400 text-xs uppercase">Handwerker (€)</label><input type="number" id="r2" value="55" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
            <div><label class="block text-gray-400 text-xs uppercase">AÜG (€)</label><input type="number" id="r3" value="45" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
        </div>
        <div class="grid grid-cols-3 gap-4 mt-2">
             <div><label class="block text-gray-400 text-xs uppercase">Anteil (%)</label><input type="number" id="p1" value="10" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
             <div><label class="block text-gray-400 text-xs uppercase">Anteil (%)</label><input type="number" id="p2" value="30" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
             <div><label class="block text-gray-400 text-xs uppercase">Anteil (%)</label><input type="number" id="p3" value="60" class="w-full bg-[#121212] border border-[#333] p-2 rounded text-white"></div>
        </div>
    </div>

    <div class="bg-[#1e1e1e] p-4 rounded-lg border border-[#333] mb-6">
        <h2 class="font-bold text-purple-400 mb-2">2. Excel Daten Import</h2>
        <div class="mb-2"><label class="text-xs text-gray-500">Start-ID für Nummerierung:</label><input type="number" id="startId" value="1000" class="bg-[#121212] border border-[#333] p-1 rounded ml-2 text-white w-24"></div>
        <textarea id="input" class="w-full h-40 bg-[#121212] border border-[#333] p-2 rounded font-mono text-sm text-white mb-2" placeholder="Kategorie (Tab) Name (Tab) Zeit&#10;rohr	Rohr DN50	30&#10;schweiss	Naht a3	12"></textarea>
        <button onclick="generate()" class="bg-purple-600 text-white px-6 py-3 rounded hover:bg-purple-700 w-full font-bold">Verschlüsselte Datei generieren</button>
    </div>

    <div class="bg-[#1e1e1e] p-4 rounded-lg border border-[#333]">
        <h2 class="font-bold text-green-400 mb-2">3. Ergebnis (Inhalt für datenbank.js)</h2>
        <textarea id="output" readonly class="w-full h-32 bg-[#121212] border border-[#333] p-2 rounded font-mono text-xs text-green-500 mb-2"></textarea>
        <button onclick="copyToClipboard()" class="bg-[#333] hover:bg-[#444] text-white py-2 px-4 rounded border border-[#555] text-sm">Code kopieren</button>
    </div>

    <script>
        function generate() {
            const settings = {
                coordinatorRate: parseFloat(document.getElementById('coord').value)||0,
                rate1: parseFloat(document.getElementById('r1').value)||0, percent1: parseFloat(document.getElementById('p1').value)||0,
                rate2: parseFloat(document.getElementById('r2').value)||0, percent2: parseFloat(document.getElementById('p2').value)||0,
                rate3: parseFloat(document.getElementById('r3').value)||0, percent3: parseFloat(document.getElementById('p3').value)||0
            };

            const lines = document.getElementById('input').value.trim().split('\n');
            const startId = parseInt(document.getElementById('startId').value) || 1000;
            const weldTypes = [];
            
            lines.forEach((line, idx) => {
                const parts = line.split('\t');
                if(parts.length < 2) return;
                
                let catRaw = parts[0].trim().toLowerCase();
                let cat = 'sonstiges';
                if(catRaw.includes('rohr')) cat='rohr'; 
                else if(catRaw.includes('schwei')) cat='schweiss';
                
                weldTypes.push({
                    id: (startId+idx).toString(),
                    category: cat,
                    name: parts[1].trim(),
                    minutesPerMeter: parseFloat(parts[2].replace(',','.'))||0
                });
            });

            const fullData = { settings, weldTypes };
            const jsonString = JSON.stringify(fullData);
            const encrypted = btoa(unescape(encodeURIComponent(jsonString)));
            
            // Wir erzeugen Code, der im Browser läuft
            const fileContent = `// GESCHÜTZTE DATENBANK (Generiert am ${new Date().toLocaleString()})\nwindow.GEHEIM_DATEN = "${encrypted}";`;
            document.getElementById('output').value = fileContent;
        }
        
        function copyToClipboard() {
            const copyText = document.getElementById("output");
            copyText.select();
            document.execCommand("copy");
            alert("Code kopiert!");
        }
    </script>
</body>
</html>
