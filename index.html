<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Werkstatt Kalkulator (Final)</title>
    
    <!-- Externe Bibliotheken -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mat: {
                            bg: '#121212',
                            surface: '#1e1e1e',
                            surface2: '#2c2c2c',
                            primary: '#bb86fc', 
                            secondary: '#03dac6', 
                            error: '#cf6679',
                            text: '#e0e0e0',
                            subtext: '#a0a0a0'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { transition: background-color 0.3s, color 0.3s; -webkit-tap-highlight-color: transparent; }
        
        /* Druck-Anpassungen */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { 
                position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 20px; 
                background-color: white !important; color: black !important; 
            }
            html, body { background-color: white !important; color: black !important; height: auto !important; overflow: visible !important; }
            .no-print { display: none !important; }
            .print-break-inside { break-inside: avoid; }
            
            /* Farben erzwingen */
            .text-white { color: black !important; }
            .text-gray-500, .text-mat-subtext { color: #555 !important; }
            .bg-gray-100 { background-color: #f3f4f6 !important; border: 1px solid #ddd; }
            .bg-blue-50 { background-color: #eff6ff !important; border: 1px solid #bfdbfe; color: #1e3a8a !important; }
        }

        /* Input Styling */
        .mat-input { transition: all 0.2s; outline: none; }
        html:not(.dark) .mat-input { background-color: #ffffff; border: 1px solid #e2e8f0; color: #1e293b; }
        html:not(.dark) .mat-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        html.dark .mat-input { background-color: #2c2c2c; border: 1px solid #444; color: white; }
        html.dark .mat-input:focus { border-color: #bb86fc; background-color: #333; }
        .mat-input:disabled { opacity: 0.6; cursor: not-allowed; }
        
        /* 1. ALLE Nummern-Pfeile verstecken */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] { 
            -moz-appearance: textfield; 
            appearance: textfield;
        }

        /* 2. NUR für Faktor wieder anzeigen */
        input[type=number].input-factor::-webkit-inner-spin-button, 
        input[type=number].input-factor::-webkit-outer-spin-button { 
            -webkit-appearance: inner-spin-button !important;
            opacity: 1 !important;
            margin-left: 5px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="font-sans min-h-screen bg-gray-100 text-slate-800 dark:bg-mat-bg dark:text-mat-text">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- KONFIGURATION ---
        const DATABASE_PATH = "datenbank.js"; 
        const STORAGE_VERSION = "v2.0";

        // ==========================================
        //  HIER DIE VERSION EINSTELLEN:
        // ==========================================
        const APP_VERSION = "v0.9.4"; 
        // ==========================================

        // --- ICONS ---
        const IconCalculator = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconSettings = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconFileText = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/></svg>;
        const IconPlus = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconTrash2 = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const IconServer = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>;
        const IconPrinter = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>;
        const IconHammer = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V2.46V2a2 2 0 0 0-2-2H2.46A2 2 0 0 0 2 2.46V7c0 1 .82 1.54 1.54 1.54h5"/></svg>;
        const IconAlert = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
        const IconLink = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>;
        const IconRefresh = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const IconWrench = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>;
        const IconMore = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>;
        const IconLock = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconUnlock = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>;
        const IconMoon = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
        const IconSun = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>;
        const IconClipboardCheck = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>;
        const IconSearch = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconChevronDown = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>;
        const IconUpload = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const IconMaximize = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M16 3h3a2 2 0 0 1 2 2v3"/><path d="M8 21H5a2 2 0 0 1-2-2v-3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>;
        const IconMinimize = (p) => <svg width="18" height="18" {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3v3a2 2 0 0 1-2 2H3"/><path d="M21 8h-3a2 2 0 0 1-2-2V3"/><path d="M3 16h3a2 2 0 0 1 2 2v3"/><path d="M16 21v-3a2 2 0 0 1 2-2h3"/></svg>;

        const DEFAULT_WELD_TYPES = []; 
        const CATEGORIES = {
            rohr: { label: "Rohrleitungs Montage & Demontage", icon: IconWrench, color: "text-indigo-600 dark:text-indigo-400", unit: 'm' },
            schweiss: { label: "Schweißarbeiten & Fertigung", icon: IconHammer, color: "text-orange-600 dark:text-orange-400", unit: '' },
            sonstiges: { label: "Sonstiges", icon: IconMore, color: "text-teal-600 dark:text-teal-400", unit: '' }
        };
        const RATE_LABELS = [
            { id: 1, label: "Spezialist/Schweißer" },
            { id: 2, label: "Handwerker" },
            { id: 3, label: "AÜG" }
        ];

        // --- SEARCHABLE SELECT ---
        const SearchableSelect = ({ options, value, onChange, placeholder = "Wählen..." }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [search, setSearch] = useState("");
            const [position, setPosition] = useState({ top: 0, left: 0, width: 0 });
            const wrapperRef = useRef(null);
            const dropdownRef = useRef(null);
            const selectedOption = options.find(o => o.id === value);
            const updatePosition = () => { if (wrapperRef.current) { const rect = wrapperRef.current.getBoundingClientRect(); setPosition({ top: rect.bottom, left: rect.left, width: rect.width }); } };
            useEffect(() => {
                const handleClickOutside = (event) => { if (wrapperRef.current && !wrapperRef.current.contains(event.target) && dropdownRef.current && !dropdownRef.current.contains(event.target)) { setIsOpen(false); setSearch(""); } };
                if (isOpen) { updatePosition(); document.addEventListener("mousedown", handleClickOutside); window.addEventListener("scroll", updatePosition, true); window.addEventListener("resize", updatePosition); }
                return () => { document.removeEventListener("mousedown", handleClickOutside); window.removeEventListener("scroll", updatePosition, true); window.removeEventListener("resize", updatePosition); };
            }, [isOpen]);
            const toggleOpen = () => { setIsOpen(!isOpen); if (!isOpen) setSearch(""); };
            const filteredOptions = options.filter(opt => opt.name.toLowerCase().includes(search.toLowerCase()));
            const dropdownContent = (
                <div ref={dropdownRef} style={{ position: 'fixed', top: position.top, left: position.left, width: position.width, zIndex: 9999 }} className="mt-1 max-h-96 overflow-auto rounded-lg shadow-2xl bg-white dark:bg-[#2c2c2c] border border-gray-200 dark:border-[#444]">
                    <div className="p-2 sticky top-0 bg-white dark:bg-[#2c2c2c] border-b border-gray-100 dark:border-[#444]"><div className="flex items-center gap-2 px-2 py-1 bg-gray-100 dark:bg-[#1e1e1e] rounded"><IconSearch size={14} className="text-gray-400"/><input type="text" autoFocus value={search} onChange={(e) => setSearch(e.target.value)} placeholder="Suchen..." className="w-full bg-transparent text-xs outline-none text-slate-800 dark:text-white"/></div></div>
                    <div className="py-1">{filteredOptions.length > 0 ? (filteredOptions.map(opt => (<div key={opt.id} onClick={() => { onChange(opt.id); setIsOpen(false); setSearch(""); }} className={`px-3 py-2 text-xs cursor-pointer hover:bg-gray-100 dark:hover:bg-[#3a3a3a] ${opt.id === value ? 'bg-blue-50 dark:bg-[#333] text-blue-600 dark:text-mat-primary' : 'text-slate-600 dark:text-gray-300'}`}><div className="font-medium">{opt.name}</div><div className="text-[10px] opacity-70">{opt.minutesPerMeter} min</div></div>))) : (<div className="px-3 py-2 text-xs text-gray-400 text-center">Keine Treffer</div>)}</div>
                </div>
            );
            return (<div className="relative w-full" ref={wrapperRef}><div onClick={toggleOpen} className={`w-full p-2 flex items-center justify-between cursor-pointer border-b bg-transparent text-sm transition-colors ${isOpen ? 'border-blue-500 dark:border-mat-primary' : 'border-gray-200 dark:border-[#333]'}`}><span className={`truncate ${!selectedOption ? 'text-gray-400' : 'text-slate-700 dark:text-white'}`}>{selectedOption ? `${selectedOption.name} (${selectedOption.minutesPerMeter} min)` : placeholder}</span><IconChevronDown className={`text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} size={14} /></div>{isOpen && ReactDOM.createPortal(dropdownContent, document.body)}</div>);
        };

        function ProjectCalculator() {
            const [darkMode, setDarkMode] = useState(() => { const saved = localStorage.getItem('kalkulator_dark'); return saved !== null ? saved === 'true' : true; });
            const [activeTab, setActiveTab] = useState('calc');
            const [projectName, setProjectName] = useState('Neues Projekt');
            const [materialCost, setMaterialCost] = useState(0);
            const [targetMargin, setTargetMargin] = useState(20);
            const [prepHours, setPrepHours] = useState(0);
            const [isExternalData, setIsExternalData] = useState(false);
            const [loadError, setLoadError] = useState(null);
            const [weldTypes, setWeldTypes] = useState(DEFAULT_WELD_TYPES);
            const [settings, setSettings] = useState({ coordinatorRate: 85.00, rate1: 65.00, percent1: 10, rate2: 0, percent2: 30, rate3: 0, percent3: 60 });
            const [entries, setEntries] = useState([]);
            const [dbSearchTerm, setDbSearchTerm] = useState("");
            const [isFullscreen, setIsFullscreen] = useState(false);
            const [dbPath, setDbPath] = useState(() => localStorage.getItem('kalkulator_db_path') || DATABASE_PATH);
            const fileInputRef = useRef(null);

            useEffect(() => { if (darkMode) document.documentElement.classList.add('dark'); else document.documentElement.classList.remove('dark'); localStorage.setItem('kalkulator_dark', darkMode); }, [darkMode]);

            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().then(() => setIsFullscreen(true)).catch(err => console.log(err));
                } else {
                    if (document.exitFullscreen) document.exitFullscreen().then(() => setIsFullscreen(false));
                }
            };
            useEffect(() => { const handleFsChange = () => setIsFullscreen(!!document.fullscreenElement); document.addEventListener("fullscreenchange", handleFsChange); return () => document.removeEventListener("fullscreenchange", handleFsChange); }, []);

            const mergeSettings = (newSettings) => { setSettings(prev => ({ ...prev, ...newSettings, percent1: newSettings.percent1 ?? prev.percent1, percent2: newSettings.percent2 ?? prev.percent2, percent3: newSettings.percent3 ?? prev.percent3 })); };
            const processExternalData = (data) => { if (data) { setWeldTypes(data.weldTypes || []); if(data.settings) mergeSettings(data.settings); setIsExternalData(true); setLoadError(null); } else { setLoadError("Format ungültig."); setIsExternalData(false); } };
            const loadDatabaseScript = (path) => { setLoadError(null); const oldScript = document.getElementById('db-script'); if (oldScript) oldScript.remove(); const script = document.createElement('script'); script.id = 'db-script'; script.src = path + "?t=" + new Date().getTime(); script.onload = () => { if (window.GEHEIM_DATEN) { try { const decodedString = decodeURIComponent(escape(atob(window.GEHEIM_DATEN))); const data = JSON.parse(decodedString); processExternalData(data); } catch (e) { setLoadError("Fehler beim Entschlüsseln."); setIsExternalData(false); } } else if (window.EXTERNE_DATEN) { processExternalData(window.EXTERNE_DATEN); } else { setLoadError("Datenbank leer oder Format falsch."); setIsExternalData(false); } }; script.onerror = () => { setLoadError("Keine Datenbank gefunden (nutze lokalen Speicher)."); setIsExternalData(false); }; document.body.appendChild(script); };
            const handleFileUpload = (event) => { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const blob = new Blob([e.target.result], {type: 'application/javascript'}); const url = URL.createObjectURL(blob); const oldScript = document.getElementById('db-script-manual'); if (oldScript) oldScript.remove(); const script = document.createElement('script'); script.id = 'db-script-manual'; script.src = url; script.onload = () => { if (window.GEHEIM_DATEN) { try { const decodedString = decodeURIComponent(escape(atob(window.GEHEIM_DATEN))); const data = JSON.parse(decodedString); processExternalData(data); } catch (e) { setLoadError("Entschlüsselung fehlgeschlagen."); } } else if (window.EXTERNE_DATEN) { processExternalData(window.EXTERNE_DATEN); } URL.revokeObjectURL(url); }; document.body.appendChild(script); } catch (err) { setLoadError("Fehler."); } }; reader.readAsText(file); };

            useEffect(() => { 
                const savedTypes = localStorage.getItem('kalkulator_weldTypes'); 
                const savedSettings = localStorage.getItem('kalkulator_settings'); 
                // FORCE RESET CHECK
                const version = localStorage.getItem('kalk_version');
                const CURRENT_VERSION = '2.1';

                if (version !== CURRENT_VERSION) {
                    setSettings({ coordinatorRate: 85.00, rate1: 65.00, percent1: 10, rate2: 0, percent2: 30, rate3: 0, percent3: 60 });
                    localStorage.setItem('kalk_version', CURRENT_VERSION);
                } else {
                    if(savedTypes) setWeldTypes(JSON.parse(savedTypes)); 
                    if(savedSettings) { const parsed = JSON.parse(savedSettings); setSettings(parsed); } 
                }
                loadDatabaseScript(dbPath); 
            }, []);

            useEffect(() => { if(!isExternalData) { localStorage.setItem('kalkulator_weldTypes', JSON.stringify(weldTypes)); localStorage.setItem('kalkulator_settings', JSON.stringify(settings)); } }, [weldTypes, settings, isExternalData]);
            const handlePathSave = () => { localStorage.setItem('kalkulator_db_path', dbPath); loadDatabaseScript(dbPath); };

            const mixedHourlyRate = ((settings.rate1 * (settings.percent1 / 100)) + (settings.rate2 * (settings.percent2 / 100)) + (settings.rate3 * (settings.percent3 / 100)));
            const calculateRowTime = (entry) => { const type = weldTypes.find(t => t.id === entry.weldTypeId); if (!type) return 0; return (entry.lengthMm || 0) * (entry.count || 0) * type.minutesPerMeter; };
            const formatTimeDisplay = (minutes) => { const hours = minutes / 60; return `${new Intl.NumberFormat('de-DE', { maximumFractionDigits: 0 }).format(minutes)} (${new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(hours)} h)`; };
            const totalRowMinutes = entries.reduce((acc, entry) => acc + calculateRowTime(entry), 0);
            const totalRowHours = totalRowMinutes / 60;
            const laborCostStandard = totalRowHours * mixedHourlyRate;
            
            // NEU: Stunden direkt nutzen
            const prepCost = prepHours * settings.coordinatorRate;

            const totalVariableCosts = laborCostStandard + prepCost + materialCost;
            const marginFactor = (100 - targetMargin) / 100;
            const safeFactor = marginFactor <= 0 ? 0.01 : marginFactor; 
            const salesPrice = totalVariableCosts / safeFactor;
            
            // PROFIT BERECHNUNG EINGEFÜGT
            const profit = salesPrice - totalVariableCosts; 

            // Helferfunktion zum Runden auf 2 Nachkommastellen bei onBlur
            const roundToTwo = (num) => Math.round((num + Number.EPSILON) * 100) / 100;

            const addEntry = (category) => { if(weldTypes.length === 0) return; const defaultType = weldTypes.find(t => t.category === category); const defaultTypeId = defaultType ? defaultType.id : ''; if (!defaultTypeId) { alert(`Keine Daten für Kategorie '${category}' in der Datenbank gefunden!`); return; } setEntries([...entries, { id: Date.now().toString(), weldTypeId: defaultTypeId, lengthMm: 0, count: 1, category }]); };
            const removeEntry = (id) => setEntries(entries.filter(e => e.id !== id));
            const updateEntry = (id, field, value) => setEntries(entries.map(e => e.id === id ? { ...e, [field]: value } : e));
            const formatCurrency = (val) => new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(val || 0);
            const formatNumber = (val) => new Intl.NumberFormat('de-DE', { maximumFractionDigits: 2 }).format(val || 0);

            return (
                <div className="w-full min-h-screen bg-gray-100 dark:bg-mat-bg text-slate-800 dark:text-mat-text transition-colors duration-300">
                    <nav className="bg-white dark:bg-mat-surface border-b border-gray-200 dark:border-[#333] sticky top-0 z-50 shadow-md no-print">
                        <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-3"><div className="w-8 h-8 bg-blue-600 dark:bg-mat-primary rounded-lg flex items-center justify-center text-white dark:text-black font-bold shadow-lg"><IconCalculator /></div><span className="font-bold text-lg tracking-wide text-slate-800 dark:text-white">Kalkulator <span className="text-blue-600 dark:text-mat-primary text-xs uppercase bg-blue-100 dark:bg-mat-surface2 px-1 rounded ml-1">Pro</span>
                                <span className="ml-2 text-xs text-gray-500 dark:text-gray-400 font-mono border border-gray-300 dark:border-gray-700 px-1 rounded">{APP_VERSION}</span>
                            </span></div>
                            <div className="flex gap-2 bg-gray-100 dark:bg-[#121212] p-1 rounded-lg border border-gray-200 dark:border-[#333]">
                                <button onClick={() => setActiveTab('calc')} className={`px-3 py-1.5 rounded-md flex items-center gap-2 text-sm transition-all ${activeTab === 'calc' ? 'bg-white dark:bg-mat-surface text-blue-600 dark:text-mat-primary shadow' : 'text-gray-500 dark:text-mat-subtext hover:text-black dark:hover:text-white'}`}><IconCalculator /> <span className="hidden sm:inline">Kalkulator</span></button>
                                <button onClick={() => setActiveTab('db')} className={`px-3 py-1.5 rounded-md flex items-center gap-2 text-sm transition-all ${activeTab === 'db' ? 'bg-white dark:bg-mat-surface text-purple-600 dark:text-mat-secondary shadow' : 'text-gray-500 dark:text-mat-subtext hover:text-black dark:hover:text-white'}`}><IconSettings /> <span className="hidden sm:inline">Datenbank</span></button>
                                <button onClick={() => setActiveTab('print')} className={`px-3 py-1.5 rounded-md flex items-center gap-2 text-sm transition-all ${activeTab === 'print' ? 'bg-white dark:bg-mat-surface text-emerald-600 dark:text-white shadow' : 'text-gray-500 dark:text-mat-subtext hover:text-black dark:hover:text-white'}`}><IconFileText /> <span className="hidden sm:inline">Ergebnis</span></button>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={toggleFullscreen} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-mat-surface2 text-gray-500 dark:text-mat-subtext transition-colors">{isFullscreen ? <IconMinimize /> : <IconMaximize />}</button>
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-mat-surface2 text-gray-500 dark:text-mat-subtext transition-colors">{darkMode ? <IconMoon /> : <IconSun />}</button>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-6xl mx-auto p-4 md:p-6 pb-20">
                        {activeTab === 'calc' && (
                            <div className="space-y-6 fade-in">
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 no-print">
                                    <div className="bg-white dark:bg-mat-surface p-5 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat mat-card">
                                        <h3 className="text-sm font-bold text-gray-500 dark:text-mat-subtext uppercase mb-4 flex items-center gap-2"><IconFileText /> Projektdaten</h3>
                                        <div className="space-y-4">
                                            <div><label className="block text-xs text-gray-500 dark:text-mat-subtext mb-1">Projekt Name</label><input type="text" value={projectName} onChange={(e) => setProjectName(e.target.value)} className="w-full p-2.5 rounded-lg mat-input" /></div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="block text-xs text-gray-500 dark:text-mat-subtext mb-1">Material (€)</label><input type="number" value={materialCost || ''} onChange={(e) => setMaterialCost(parseFloat(e.target.value) || 0)} className="w-full p-2.5 rounded-lg mat-input" /></div>
                                                <div><label className="block text-xs text-gray-500 dark:text-mat-subtext mb-1">Deckungsbeitrag (%)</label><input type="number" value={targetMargin || ''} onChange={(e) => setTargetMargin(parseFloat(e.target.value) || 0)} className="w-full p-2.5 rounded-lg mat-input" /></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-gradient-to-br from-blue-700 to-indigo-800 dark:from-[#2c2c2c] dark:to-[#1e1e1e] p-5 rounded-xl border border-transparent dark:border-[#333] shadow-lg flex flex-col justify-between relative overflow-hidden">
                                        <div className="absolute top-0 right-0 w-24 h-24 bg-white dark:bg-mat-primary opacity-10 rounded-full -mr-10 -mt-10 blur-xl"></div>
                                        <div><h3 className="text-sm font-bold text-blue-100 dark:text-mat-primary mb-4">Kalkulation</h3><div className="space-y-2 text-sm text-blue-50 dark:text-mat-subtext"><div className="flex justify-between"><span>Arbeitszeit:</span><span className="text-white font-mono">{formatNumber(totalRowHours + prepHours)} h</span></div><div className="flex justify-between"><span>Herstellkosten:</span><span className="text-white font-mono">{formatCurrency(totalVariableCosts)}</span></div></div></div>
                                        <div className="mt-6 pt-4 border-t border-white/20 dark:border-white/10"><div className="flex justify-between items-end"><span className="text-blue-200 dark:text-mat-subtext text-xs font-bold uppercase">Verkaufspreis</span><span className="text-2xl font-bold text-white">{formatCurrency(salesPrice)}</span></div></div>
                                    </div>
                                </div>

                                <div className="bg-white dark:bg-mat-surface p-4 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat flex items-center justify-between no-print mat-card">
                                    <div className="flex items-center gap-3"><div className="bg-emerald-100 dark:bg-[#2a2a2a] p-2 rounded-lg text-emerald-600 dark:text-mat-secondary"><IconClipboardCheck /></div><div><span className="block font-bold text-slate-700 dark:text-white text-sm">Arbeitsvorbereitung</span><span className="text-xs text-gray-500 dark:text-mat-subtext">Spezial-Satz: {formatCurrency(settings.coordinatorRate)}/h</span></div></div>
                                    <div className="flex items-center gap-2"><label className="text-xs text-gray-500 dark:text-mat-subtext">Stunden:</label><input type="number" step="0.25" value={prepHours || ''} onChange={(e) => setPrepHours(parseFloat(e.target.value) || 0)} placeholder="0" className="w-20 p-2 rounded-lg mat-input text-right font-mono" /></div>
                                </div>

                                {[
                                    { key: "rohr", ...CATEGORIES.rohr },
                                    { key: "schweiss", ...CATEGORIES.schweiss },
                                    { key: "sonstiges", ...CATEGORIES.sonstiges }
                                ].map((cat) => (
                                    <div key={cat.key} className="bg-white dark:bg-mat-surface p-5 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat print-break-inside mat-card">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className={`text-sm font-bold flex items-center gap-2 ${cat.color}`}><cat.icon /> {cat.label}</h3>
                                            <button onClick={() => addEntry(cat.key)} className="flex items-center gap-2 bg-slate-100 dark:bg-[#2c2c2c] hover:bg-slate-200 dark:hover:bg-[#333] text-slate-700 dark:text-white px-3 py-1.5 rounded transition-colors text-xs font-bold no-print border border-gray-200 dark:border-[#444]"><IconPlus /> Neu</button>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-xs text-left">
                                                <thead className="text-gray-500 dark:text-mat-subtext uppercase border-b border-gray-100 dark:border-[#333]">
                                                    <tr>
                                                        <th className="p-3">Typ</th>
                                                        {cat.key === 'rohr' ? ( <th className="p-3 text-right">Länge (m)</th> ) : ( <th className="p-3 text-right text-gray-400">Länge</th> )}
                                                        <th className="p-3 text-right">Faktor</th>
                                                        <th className="p-3 text-right">Zeit</th>
                                                        <th className="p-3 w-8 no-print"></th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-100 dark:divide-[#2a2a2a]">
                                                    {entries.filter(e => e.category === cat.key).map((entry) => (
                                                        <tr key={entry.id} className="hover:bg-gray-50 dark:hover:bg-[#252525]">
                                                            <td className="p-2 w-1/3"><SearchableSelect options={weldTypes.filter(t => t.category === cat.key)} value={entry.weldTypeId} onChange={(newId) => updateEntry(entry.id, 'weldTypeId', newId)}/></td>
                                                            <td className="p-2"><input type="number" value={entry.lengthMm || ''} onChange={(e) => updateEntry(entry.id, 'lengthMm', parseFloat(e.target.value) || 0)} disabled={cat.key !== 'rohr'} className="w-full bg-transparent text-right text-indigo-600 dark:text-mat-secondary outline-none border-b border-transparent focus:border-indigo-500 dark:focus:border-mat-secondary disabled:text-gray-400" /></td>
                                                            <td className="p-2"><input type="number" value={entry.count || ''} onChange={(e) => updateEntry(entry.id, 'count', parseFloat(e.target.value) || 0)} className="w-full bg-transparent text-right text-slate-700 dark:text-white outline-none border-b border-transparent focus:border-slate-500 dark:focus:border-white input-factor" /></td>
                                                            <td className="p-2 text-right font-mono text-gray-600 dark:text-mat-subtext whitespace-nowrap">{formatTimeDisplay(calculateRowTime(entry))}</td>
                                                            <td className="p-2 text-center no-print"><button onClick={() => removeEntry(entry.id)} className="text-gray-400 hover:text-red-500 dark:text-[#555] dark:hover:text-mat-error"><IconTrash2 /></button></td>
                                                        </tr>
                                                    ))}
                                                    {entries.filter(e => e.category === cat.key).length === 0 && <tr><td colSpan={5} className="p-4 text-center text-gray-400 dark:text-[#444] italic">Leer</td></tr>}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                ))}
                                <div className="text-center text-xs text-gray-400 dark:text-[#444] no-print pb-10">Basis: Mischstundensatz {formatCurrency(mixedHourlyRate)}/h</div>
                            </div>
                        )}
                        {/* --- TAB 2: DATENBANK --- */}
                        {activeTab === 'db' && (
                            <div className="space-y-6 fade-in max-w-2xl mx-auto">
                                <div className="bg-white dark:bg-mat-surface p-5 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat">
                                    <h3 className="text-sm font-bold text-slate-800 dark:text-white mb-6 uppercase tracking-wider border-b border-gray-100 dark:border-[#333] pb-2">Konfiguration</h3>
                                    <div className="mb-6"><label className="text-xs font-bold text-emerald-600 dark:text-mat-secondary uppercase mb-2 block">Koordinator (Arbeitsvorb.)</label><div className="flex items-center gap-2"><input type="number" disabled={isExternalData} value={settings.coordinatorRate || ''} onBlur={(e) => setSettings({...settings, coordinatorRate: roundToTwo(parseFloat(e.target.value) || 0)})} onChange={(e) => setSettings({...settings, coordinatorRate: parseFloat(e.target.value) || 0})} className="w-full p-2.5 rounded-lg mat-input" /><span className="text-gray-500 dark:text-mat-subtext text-xs">€/h</span></div></div>
                                    <div className="space-y-4"><label className="text-xs font-bold text-blue-600 dark:text-mat-primary uppercase block">Mischkalkulation (Montage)</label>
                                        {RATE_LABELS.map(({id, label}) => (
                                            <div key={id} className="grid grid-cols-2 gap-4">
                                                <div><span className="text-[10px] text-gray-500 dark:text-mat-subtext uppercase mb-1 block">{label} (€)</span><input type="number" disabled={isExternalData} value={settings[`rate${id}`] || ''} onBlur={(e) => setSettings({...settings, [`rate${id}`]: roundToTwo(parseFloat(e.target.value) || 0)})} onChange={(e) => setSettings({...settings, [`rate${id}`]: parseFloat(e.target.value) || 0})} className="w-full p-2 rounded-lg mat-input" /></div>
                                                <div><span className="text-[10px] text-gray-500 dark:text-mat-subtext uppercase mb-1 block">Anteil (%)</span><input type="number" disabled={false} value={settings[`percent${id}`] || ''} onChange={(e) => setSettings({...settings, [`percent${id}`]: parseFloat(e.target.value) || 0})} className="w-full p-2 rounded-lg mat-input" /></div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="mt-4 pt-3 border-t border-gray-100 dark:border-[#333] flex justify-between text-sm"><span className="text-gray-500 dark:text-mat-subtext">Ergebnis Mischsatz:</span><span className="font-bold text-slate-800 dark:text-white">{formatCurrency(mixedHourlyRate)}</span></div>
                                </div>
                                <div className="bg-white dark:bg-mat-surface p-5 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat">
                                    <div className="flex justify-between items-center mb-4 border-b border-gray-100 dark:border-[#333] pb-2"><h3 className="text-sm font-bold text-slate-800 dark:text-white uppercase tracking-wider">Arbeitswerte</h3><div className="flex items-center gap-2 bg-gray-100 dark:bg-[#1e1e1e] px-2 py-1 rounded"><IconSearch size={14} className="text-gray-400"/><input type="text" value={dbSearchTerm} onChange={(e) => setDbSearchTerm(e.target.value)} placeholder="Suchen..." className="bg-transparent text-xs outline-none w-32 dark:text-white" /></div></div>
                                    <div className="max-h-96 overflow-y-auto">{weldTypes.filter(t => t.name.toLowerCase().includes(dbSearchTerm.toLowerCase())).map((type) => (<div key={type.id} className="flex gap-2 mb-2"><input type="text" disabled={isExternalData} value={type.name} className="w-full p-2 rounded bg-transparent border border-gray-200 dark:border-[#333] text-sm text-slate-600 dark:text-mat-subtext focus:border-blue-500 dark:focus:border-mat-primary outline-none" /><input type="number" disabled={isExternalData} value={type.minutesPerMeter} onBlur={(e) => { const newTypes = weldTypes.map(t => t.id === type.id ? {...t, minutesPerMeter: roundToTwo(parseFloat(e.target.value)||0)} : t); setWeldTypes(newTypes); }} onChange={(e) => { const newTypes = weldTypes.map(t => t.id === type.id ? {...t, minutesPerMeter: parseFloat(e.target.value)||0} : t); setWeldTypes(newTypes); }} className="w-32 text-right p-2 rounded bg-transparent border border-gray-200 dark:border-[#333] text-sm text-slate-800 dark:text-white focus:border-blue-500 dark:focus:border-mat-primary outline-none" /></div>))}</div>
                                </div>
                                <div className="bg-white dark:bg-mat-surface p-5 rounded-xl border border-gray-200 dark:border-[#333] shadow-md dark:shadow-mat mt-8">
                                    <h3 className="text-sm font-bold text-gray-500 dark:text-mat-subtext mb-4 flex items-center gap-2"><IconLink /> Verbindung</h3>
                                    <div className="space-y-4 animate-fade-in">
                                        <div className="flex justify-between items-center mb-1"><label className="block text-xs text-gray-500 dark:text-mat-subtext">Laden von:</label><input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".js" className="hidden" /><button onClick={() => fileInputRef.current.click()} className="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1 transition-colors"><IconUpload size={12}/> Manuell</button></div>
                                        <div className="flex gap-2"><code className="block w-full p-3 rounded-lg bg-gray-100 dark:bg-[#121212] border border-gray-200 dark:border-[#333] text-xs font-mono text-gray-700 dark:text-mat-text overflow-hidden">{DATABASE_PATH}</code></div>
                                        <div className={`p-2 rounded text-xs border flex items-center gap-2 ${isExternalData ? 'border-blue-200 text-blue-600 dark:border-mat-secondary dark:text-mat-secondary' : 'border-orange-200 text-orange-600 dark:border-orange-500 dark:text-orange-500'}`}><IconServer size={14} />{loadError ? loadError : (isExternalData ? "Verbunden (Extern)" : "Lokaler Browser-Speicher")}</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* --- TAB 3: PRINT --- */}
                        {activeTab === 'print' && (
                            <div id="print-area" className="max-w-4xl mx-auto" style={{ backgroundColor: 'white', color: 'black', padding: '40px' }}>
                                <div className="border-b-2 border-black pb-6 mb-8 flex justify-between items-end"><div><h1 className="text-4xl font-extrabold tracking-tighter" style={{color:'black'}}>KALKULATION</h1><p className="text-gray-500 mt-1" style={{color:'#555'}}>Interne Berechnung</p></div><div className="text-right"><p className="font-bold text-xl" style={{color:'black'}}>{projectName}</p><p className="text-sm text-gray-500" style={{color:'#555'}}>{new Date().toLocaleDateString('de-DE')}</p></div></div>
                                <div className="grid grid-cols-3 gap-6 mb-8">
                                    <div className="bg-gray-100 p-4 rounded border border-gray-200" style={{backgroundColor:'#f3f4f6', borderColor:'#e5e7eb'}}><span className="text-xs font-bold text-gray-500 uppercase block" style={{color:'#6b7280'}}>Stunden</span><span className="text-2xl font-bold" style={{color:'black'}}>{formatNumber(totalRowHours + prepHours)} h</span></div>
                                    <div className="bg-gray-100 p-4 rounded border border-gray-200" style={{backgroundColor:'#f3f4f6', borderColor:'#e5e7eb'}}><span className="text-xs font-bold text-gray-500 uppercase block" style={{color:'#6b7280'}}>Material</span><span className="text-2xl font-bold" style={{color:'black'}}>{formatCurrency(materialCost)}</span></div>
                                    <div className="bg-blue-50 p-4 rounded border border-blue-200 text-blue-900" style={{backgroundColor:'#eff6ff', borderColor:'#bfdbfe', color:'#1e3a8a'}}><span className="text-xs font-bold text-blue-600 uppercase block" style={{color:'#2563eb'}}>Preis</span><span className="text-2xl font-bold">{formatCurrency(salesPrice)}</span></div>
                                </div>
                                <div className="mb-8 border-b border-gray-200 pb-4" style={{borderColor:'#e5e7eb'}}><h3 className="text-xs font-bold uppercase text-gray-500 mb-2" style={{color:'#6b7280'}}>Zusatzleistungen</h3><div className="flex justify-between py-1 border-b border-gray-100" style={{borderColor:'#f3f4f6'}}><span>Arbeitsvorbereitung (Koordinator)</span><div className="w-48 flex justify-between"><span>{formatNumber(prepHours)} Std</span><span className="font-mono">{formatCurrency(prepCost)}</span></div></div></div>
                                <div className="mb-12">{['rohr', 'schweiss', 'sonstiges'].map(catKey => { const catEntries = entries.filter(e => e.category === catKey); if (catEntries.length === 0) return null; return (<div key={catKey} className="mb-6 print-break-inside"><h4 className="text-xs font-bold uppercase text-gray-500 mb-2 border-b border-gray-300 pb-1" style={{color:'#6b7280', borderColor:'#d1d5db'}}>{CATEGORIES[catKey].label}</h4><table className="w-full text-sm"><thead className="text-gray-400 text-xs uppercase" style={{color:'#9ca3af'}}><tr><th className="text-left py-1">Pos</th><th className="text-right py-1">Faktor</th><th className="text-right py-1">Menge</th><th className="text-right py-1">Zeit</th></tr></thead><tbody>{catEntries.map(entry => { const t = weldTypes.find(x => x.id === entry.weldTypeId); return (<tr key={entry.id} className="border-b border-gray-100" style={{borderColor:'#f3f4f6'}}><td className="py-2 font-medium" style={{color:'black'}}>{t?.name}</td><td className="py-2 text-right text-gray-600" style={{color:'#4b5563'}}>{entry.count}</td><td className="py-2 text-right text-gray-600" style={{color:'#4b5563'}}>{formatNumber(entry.lengthMm)}</td><td className="py-2 text-right font-mono" style={{color:'black'}}>{formatTimeDisplay(calculateRowTime(entry))}</td></tr>) })}</tbody></table></div>) })}</div>
                                <div className="flex justify-end print-break-inside"><div className="w-1/2 space-y-2 text-sm text-right"><div className="flex justify-between text-gray-600" style={{color:'#4b5563'}}><span>Material</span><span>{formatCurrency(materialCost)}</span></div><div className="flex justify-between text-gray-600" style={{color:'#4b5563'}}><span>Personal (Misch + Koord.)</span><span>{formatCurrency(laborCostStandard + prepCost)}</span></div><div className="flex justify-between font-bold border-t border-gray-300 pt-2 mt-2" style={{borderColor:'#d1d5db'}}><span style={{color:'black'}}>Herstellkosten</span><span style={{color:'black'}}>{formatCurrency(totalVariableCosts)}</span></div><div className="flex justify-between text-green-600 text-xs" style={{color:'#16a34a'}}><span>Marge ({targetMargin}%)</span><span>{formatCurrency(profit)}</span></div><div className="flex justify-between font-extrabold text-2xl border-t-2 border-black pt-2 mt-2" style={{borderColor:'black'}}><span style={{color:'black'}}>Endpreis</span><span style={{color:'black'}}>{formatCurrency(salesPrice)}</span></div></div></div>
                                <div className="mt-8 text-right no-print"><button onClick={() => window.print()} className="bg-black text-white px-6 py-2 rounded font-bold hover:bg-gray-800">Drucken</button></div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProjectCalculator />);
    </script>
</body>
</html>